{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { EventsRegistry } from \"./types\";\n\nconst EventRegistry: EventsRegistry = {};\n\nexport { EventRegistry };\n\n/**\n * The global event listener.\n *\n */\nexport function globalListener(e: Event): void {\n  const that = this;\n  const { type } = e;\n\n  [...EventRegistry[type]].forEach((elementsMap) => {\n    const [element, listenersMap] = elementsMap;\n    /* istanbul ignore else */\n    if (element === that) {\n      [...listenersMap].forEach((listenerMap) => {\n        const [listener, options] = listenerMap;\n        listener.apply(element, [e]);\n\n        if (options && options.once) {\n          removeListener(element, type, listener, options);\n        }\n      });\n    }\n  });\n}\n\n/**\n * Register a new listener with its options and attach the `globalListener`\n * to the target if this is the first listener.\n */\nexport const addListener = (\n  element: EventTarget,\n  eventType: string,\n  listener: EventListenerObject[\"handleEvent\"],\n  options?: AddEventListenerOptions\n): void => {\n  // get element listeners first\n  if (!EventRegistry[eventType]) {\n    EventRegistry[eventType] = new Map();\n  }\n  const oneEventMap = EventRegistry[eventType];\n\n  if (!oneEventMap.has(element)) {\n    oneEventMap.set(element, new Map());\n  }\n  const oneElementMap = oneEventMap.get(element);\n\n  // get listeners size\n  const { size } = oneElementMap;\n\n  // register listener with its options\n  oneElementMap.set(listener, options);\n\n  // add listener last\n  if (!size) {\n    element.addEventListener(eventType, globalListener, options);\n  }\n};\n\n/**\n * Remove a listener from registry and detach the `globalListener`\n * if no listeners are found in the registry.\n *\n */\nexport const removeListener = (\n  element: EventTarget,\n  eventType: string,\n  listener: EventListenerObject[\"handleEvent\"],\n  options?: AddEventListenerOptions\n): void => {\n  // get listener first\n  const oneEventMap = EventRegistry[eventType];\n  const oneElementMap = oneEventMap && oneEventMap.get(element);\n  const savedOptions = oneElementMap && oneElementMap.get(listener);\n\n  // also recover initial options\n  const eventOptions = savedOptions !== undefined ? savedOptions : options;\n\n  // unsubscribe second, remove from registry\n  if (oneElementMap && oneElementMap.has(listener))\n    oneElementMap.delete(listener);\n  if (oneEventMap && (!oneElementMap || !oneElementMap.size))\n    oneEventMap.delete(element);\n  if (!oneEventMap || !oneEventMap.size) delete EventRegistry[eventType];\n\n  // remove listener last\n  /* istanbul ignore else */\n  if (!oneElementMap || !oneElementMap.size) {\n    element.removeEventListener(eventType, globalListener, eventOptions);\n  }\n};\n\n/**\n * Advanced event listener based on subscribe / publish pattern.\n * @see https://www.patterns.dev/posts/classic-design-patterns/#observerpatternjavascript\n * @see https://gist.github.com/shystruk/d16c0ee7ac7d194da9644e5d740c8338#file-subpub-js\n * @see https://hackernoon.com/do-you-still-register-window-event-listeners-in-each-component-react-in-example-31a4b1f6f1c8\n */\nconst Listener = {\n  on: addListener,\n  off: removeListener,\n  globalListener,\n  registry: EventRegistry,\n};\n\nexport default Listener;\n"],
  "mappings": ";wbAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,mBAAAE,EAAA,gBAAAC,EAAA,YAAAC,EAAA,mBAAAC,EAAA,mBAAAC,IAEA,IAAMJ,EAAgC,CAAC,EAQhC,SAASK,EAAeC,EAAgB,CAC7C,IAAMC,EAAO,KACP,CAAE,KAAAC,CAAK,EAAIF,EAEjB,CAAC,GAAGG,EAAcD,EAAK,EAAE,QAASE,GAAgB,CAChD,GAAM,CAACC,EAASC,CAAY,EAAIF,EAE5BC,IAAYJ,GACd,CAAC,GAAGK,CAAY,EAAE,QAASC,GAAgB,CACzC,GAAM,CAACC,EAAUC,CAAO,EAAIF,EAC5BC,EAAS,MAAMH,EAAS,CAACL,CAAC,CAAC,EAEvBS,GAAWA,EAAQ,MACrBC,EAAeL,EAASH,EAAMM,EAAUC,CAAO,CAEnD,CAAC,CAEL,CAAC,CACH,CAMO,IAAME,EAAc,CACzBN,EACAO,EACAJ,EACAC,IACS,CAEJN,EAAcS,KACjBT,EAAcS,GAAa,IAAI,KAEjC,IAAMC,EAAcV,EAAcS,GAE7BC,EAAY,IAAIR,CAAO,GAC1BQ,EAAY,IAAIR,EAAS,IAAI,GAAK,EAEpC,IAAMS,EAAgBD,EAAY,IAAIR,CAAO,EAGvC,CAAE,KAAAU,CAAK,EAAID,EAGjBA,EAAc,IAAIN,EAAUC,CAAO,EAG9BM,GACHV,EAAQ,iBAAiBO,EAAWb,EAAgBU,CAAO,CAE/D,EAOaC,EAAiB,CAC5BL,EACAO,EACAJ,EACAC,IACS,CAET,IAAMI,EAAcV,EAAcS,GAC5BE,EAAgBD,GAAeA,EAAY,IAAIR,CAAO,EACtDW,EAAeF,GAAiBA,EAAc,IAAIN,CAAQ,EAG1DS,EAAeD,IAAiB,OAAYA,EAAeP,EAG7DK,GAAiBA,EAAc,IAAIN,CAAQ,GAC7CM,EAAc,OAAON,CAAQ,EAC3BK,IAAgB,CAACC,GAAiB,CAACA,EAAc,OACnDD,EAAY,OAAOR,CAAO,GACxB,CAACQ,GAAe,CAACA,EAAY,OAAM,OAAOV,EAAcS,IAIxD,CAACE,GAAiB,CAACA,EAAc,OACnCT,EAAQ,oBAAoBO,EAAWb,EAAgBkB,CAAY,CAEvE,EAQMC,EAAW,CACf,GAAIP,EACJ,IAAKD,EACL,eAAAX,EACA,SAAUI,CACZ,EAEOgB,EAAQD",
  "names": ["src_exports", "__export", "EventRegistry", "addListener", "src_default", "globalListener", "removeListener", "globalListener", "e", "that", "type", "EventRegistry", "elementsMap", "element", "listenersMap", "listenerMap", "listener", "options", "removeListener", "addListener", "eventType", "oneEventMap", "oneElementMap", "size", "savedOptions", "eventOptions", "Listener", "src_default"]
}

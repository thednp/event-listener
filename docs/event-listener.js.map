{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { EventsRegistry } from './types';\n\nconst EventRegistry: EventsRegistry = {};\n\nexport { EventRegistry };\n\n/**\n * The global event listener. This function must be a Function.\n *\n */\nexport function globalListener(e: Event): void {\n  const that = this;\n  const { type } = e;\n\n  [...EventRegistry[type]].forEach((elementsMap) => {\n    const [element, listenersMap] = elementsMap;\n    /* istanbul ignore else */\n    if (element === that) {\n      [...listenersMap].forEach((listenerMap) => {\n        const [listener, options] = listenerMap;\n        listener.apply(element, [e]);\n\n        if (options && options.once) {\n          removeListener(element, type, listener, options);\n        }\n      });\n    }\n  });\n}\n\n/**\n * Register a new listener with its options and attach the `globalListener`\n * to the target if this is the first listener.\n */\nexport const addListener = (\n  element: EventTarget,\n  eventType: string,\n  listener: EventListener,\n  options?: AddEventListenerOptions\n): void => {\n  // get element listeners first\n  if (!EventRegistry[eventType]) {\n    EventRegistry[eventType] = new Map();\n  }\n  const oneEventMap = EventRegistry[eventType];\n\n  if (!oneEventMap.has(element)) {\n    oneEventMap.set(element, new Map());\n  }\n  const oneElementMap = oneEventMap.get(element);\n\n  // get listeners size\n  if (typeof oneElementMap === 'undefined') return;\n\n  const { size } = oneElementMap;\n\n  // register listener with its options\n  oneElementMap.set(listener, options);\n\n  // add listener last\n  if (!size) {\n    element.addEventListener(eventType, globalListener, options);\n  }\n};\n\n/**\n * Remove a listener from registry and detach the `globalListener`\n * if no listeners are found in the registry.\n *\n */\nexport const removeListener = (\n  element: EventTarget,\n  eventType: string,\n  listener: EventListener,\n  options?: AddEventListenerOptions\n): void => {\n  // get listener first\n  const oneEventMap = EventRegistry[eventType];\n  const oneElementMap = oneEventMap && oneEventMap.get(element);\n  const savedOptions = oneElementMap && oneElementMap.get(listener);\n\n  // also recover initial options\n  const eventOptions = savedOptions !== undefined ? savedOptions : options;\n\n  // unsubscribe second, remove from registry\n  if (oneElementMap && oneElementMap.has(listener)) oneElementMap.delete(listener);\n  if (oneEventMap && (!oneElementMap || !oneElementMap.size)) oneEventMap.delete(element);\n  if (!oneEventMap || !oneEventMap.size) delete EventRegistry[eventType];\n\n  // remove listener last\n  /* istanbul ignore else */\n  if (!oneElementMap || !oneElementMap.size) {\n    element.removeEventListener(eventType, globalListener, eventOptions);\n  }\n};\n\n/**\n * Advanced event listener based on subscribe / publish pattern.\n * @see https://www.patterns.dev/posts/classic-design-patterns/#observerpatternjavascript\n * @see https://gist.github.com/shystruk/d16c0ee7ac7d194da9644e5d740c8338#file-subpub-js\n * @see https://hackernoon.com/do-you-still-register-window-event-listeners-in-each-component-react-in-example-31a4b1f6f1c8\n */\nexport default {\n  on: addListener,\n  off: removeListener,\n  globalListener,\n  registry: EventRegistry,\n};\n\n// export default Listener;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,MAAM,gBAAgC,CAAC;AAQhC,WAAS,eAAe,GAAgB;AAC7C,UAAM,OAAO;AACb,UAAM,EAAE,KAAK,IAAI;AAEjB,KAAC,GAAG,cAAc,KAAK,EAAE,QAAQ,CAAC,gBAAgB;AAChD,YAAM,CAAC,SAAS,YAAY,IAAI;AAEhC,UAAI,YAAY,MAAM;AACpB,SAAC,GAAG,YAAY,EAAE,QAAQ,CAAC,gBAAgB;AACzC,gBAAM,CAAC,UAAU,OAAO,IAAI;AAC5B,mBAAS,MAAM,SAAS,CAAC,CAAC,CAAC;AAE3B,cAAI,WAAW,QAAQ,MAAM;AAC3B,2BAAe,SAAS,MAAM,UAAU,OAAO;AAAA,UACjD;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF,CAAC;AAAA,EACH;AAMO,MAAM,cAAc,CACzB,SACA,WACA,UACA,YACS;AAET,QAAI,CAAC,cAAc,YAAY;AAC7B,oBAAc,aAAa,oBAAI,IAAI;AAAA,IACrC;AACA,UAAM,cAAc,cAAc;AAElC,QAAI,CAAC,YAAY,IAAI,OAAO,GAAG;AAC7B,kBAAY,IAAI,SAAS,oBAAI,IAAI,CAAC;AAAA,IACpC;AACA,UAAM,gBAAgB,YAAY,IAAI,OAAO;AAG7C,QAAI,OAAO,kBAAkB;AAAa;AAE1C,UAAM,EAAE,KAAK,IAAI;AAGjB,kBAAc,IAAI,UAAU,OAAO;AAGnC,QAAI,CAAC,MAAM;AACT,cAAQ,iBAAiB,WAAW,gBAAgB,OAAO;AAAA,IAC7D;AAAA,EACF;AAOO,MAAM,iBAAiB,CAC5B,SACA,WACA,UACA,YACS;AAET,UAAM,cAAc,cAAc;AAClC,UAAM,gBAAgB,eAAe,YAAY,IAAI,OAAO;AAC5D,UAAM,eAAe,iBAAiB,cAAc,IAAI,QAAQ;AAGhE,UAAM,eAAe,iBAAiB,SAAY,eAAe;AAGjE,QAAI,iBAAiB,cAAc,IAAI,QAAQ;AAAG,oBAAc,OAAO,QAAQ;AAC/E,QAAI,gBAAgB,CAAC,iBAAiB,CAAC,cAAc;AAAO,kBAAY,OAAO,OAAO;AACtF,QAAI,CAAC,eAAe,CAAC,YAAY;AAAM,aAAO,cAAc;AAI5D,QAAI,CAAC,iBAAiB,CAAC,cAAc,MAAM;AACzC,cAAQ,oBAAoB,WAAW,gBAAgB,YAAY;AAAA,IACrE;AAAA,EACF;AAQA,MAAO,cAAQ;AAAA,IACb,IAAI;AAAA,IACJ,KAAK;AAAA,IACL;AAAA,IACA,UAAU;AAAA,EACZ;",
  "names": []
}
